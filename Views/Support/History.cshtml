@model List<SupportTicket>
@{
    Layout = "~/Views/Shared/_LayoutDriver.cshtml";
    ViewData["Title"] = "Nh·∫≠t k√Ω h·ªó tr·ª£";
}

<div class="container mt-4 mb-5" style="max-width: 800px;">

    <h3 class="fw-bold mb-4">
        <i class="bi bi-journal-text me-2"></i> Nh·∫≠t k√Ω h·ªó tr·ª£ c·ªßa b·∫°n
    </h3>

    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success">@TempData["Success"]</div>
    }
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger">@TempData["Error"]</div>
    }

    @if (!Model.Any())
    {
        <div class="alert alert-info text-center py-4 shadow-sm">
            <i class="bi bi-inbox fs-2 d-block mb-2"></i>
            B·∫°n ch∆∞a g·ª≠i y√™u c·∫ßu h·ªó tr·ª£ n√†o.
        </div>
    }
    else
    {
        <div class="list-group">
            @foreach (var t in Model.OrderByDescending(x => x.CreatedAt))
            {
                <div class="list-group-item mb-3 shadow-sm rounded-4 border-0 p-4">

                    <!-- HEADER + STATUS -->
                    <div class="d-flex justify-content-between">
                        <small class="text-muted">
                            <i class="bi bi-clock me-1"></i> @t.CreatedAt.ToString("dd/MM/yyyy HH:mm")
                        </small>

                        @if (t.Status == "pending")
                        {
                            <span class="badge bg-warning text-dark px-3 py-2 rounded-pill">
                                <i class="bi bi-hourglass-split me-1"></i> Ch·ªù ph·∫£n h·ªìi
                            </span>
                        }
                        else
                        {
                            <span class="badge bg-success px-3 py-2 rounded-pill">
                                <i class="bi bi-check-circle me-1"></i> ƒê√£ ph·∫£n h·ªìi
                            </span>
                        }
                    </div>

                    <hr />

                    <!-- USER MESSAGE -->
                    <div class="mb-3">
                        <label class="fw-bold">üì© Y√™u c·∫ßu c·ªßa b·∫°n:</label>
                        <div class="p-3 bg-light rounded-3 border">
                            @t.Message
                        </div>
                    </div>

                    <!-- ADMIN REPLY (thread text) -->
                    @if (!string.IsNullOrEmpty(t.Reply))
                    {
                        <div class="mb-2">
                            <label class="fw-bold text-success">üí¨ Ph·∫£n h·ªìi / h·ªôi tho·∫°i:</label>
                            <div class="p-3 bg-white rounded-3 border" style="white-space:pre-line;">
                                @t.Reply
                            </div>
                        </div>

                        <small class="text-muted d-block mb-2">
                            <i class="bi bi-calendar-check me-1"></i>
                            @t.RepliedAt?.ToString("dd/MM/yyyy HH:mm")
                        </small>
                    }
                    else
                    {
                        <div class="text-muted fst-italic mb-2">
                            <i class="bi bi-chat-left-dots me-1"></i> Ch∆∞a c√≥ ph·∫£n h·ªìi.
                        </div>
                    }

                    <!-- DRIVER REPLY FORM -->
                    <form asp-action="AddReply" asp-controller="Support" method="post" class="mt-2">
                        @Html.AntiForgeryToken()
                        <input type="hidden" name="id" value="@t.Id" />
                        <div class="input-group">
                            <input type="text"
                                   name="replyText"
                                   class="form-control"
                                   placeholder="Tr·∫£ l·ªùi th√™m cho admin..." />
                            <button class="btn btn-outline-primary">
                                G·ª≠i
                            </button>
                        </div>
                        <small class="text-muted">
                            Tin nh·∫Øn s·∫Ω ƒë∆∞·ª£c th√™m v√†o h·ªôi tho·∫°i v√† g·ª≠i cho b·ªô ph·∫≠n h·ªó tr·ª£.
                        </small>
                    </form>

                </div>
            }
        </div>
    }

    <div class="mt-4 text-center">
        <a href="/Support" class="btn btn-secondary rounded-3 px-4 py-2">
            <i class="bi bi-arrow-left me-1"></i> Quay l·∫°i h·ªó tr·ª£
        </a>
    </div>
</div>
