@model WedNightFury.Models.Order
@{
    ViewData["Title"] = "Äiá»ƒm giao: " + Model.Code;
    Layout = "~/Views/Shared/_LayoutDriver.cshtml";
}

<style>
    .card-box {
        background: #fff;
        padding: 18px;
        border-radius: 14px;
        box-shadow: 0 4px 18px rgba(0,0,0,0.08);
        margin-bottom: 18px;
    }

    .map-wrapper {
        width: 100%;
        height: 360px;
        border-radius: 12px;
        overflow: hidden;
        background: #f5f5f5;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #777;
    }

    .btn-driver {
        width: 100%;
        padding: 14px;
        font-size: 17px;
        font-weight: 600;
        border-radius: 12px;
    }

    .info-row {
        margin-bottom: 6px;
        font-size: 16px;
    }

    .info-label {
        font-weight: 600;
        color: #444;
    }
</style>

<div class="container mt-3">

    <h3 class="fw-bold text-danger mb-3">ğŸ“¦ ÄIá»‚M GIAO: @Model.Code</h3>

    <div class="card-box">
        <div class="info-row">
            <span class="info-label">ğŸ“Œ Táº¡o Ä‘Æ¡n:</span>
            @Model.CreatedAt?.ToString("dd/MM/yyyy HH:mm")
        </div>

        <div class="info-row">
            <span class="info-label">ğŸšš Äang giao lÃºc:</span>
            @Model.AssignedAt?.ToString("dd/MM/yyyy HH:mm")
        </div>

        <hr />

        <div class="info-row"><b>ğŸ‘¤ NgÆ°á»i nháº­n:</b> @Model.ReceiverName</div>
        <div class="info-row"><b>ğŸ“ SÄT:</b> @Model.ReceiverPhone</div>
        <div class="info-row"><b>ğŸ“ Äá»‹a chá»‰:</b> @Model.ReceiverAddress</div>

        <div class="info-row"><b>ğŸ’° GiÃ¡ trá»‹ hÃ ng:</b> @String.Format("{0:N0}", Model.Value) Ä‘</div>
        <div class="info-row"><b>ğŸ’¸ COD:</b> @String.Format("{0:N0}", Model.Cod) Ä‘</div>
        <div class="info-row"><b>ğŸš› PhÃ­ ship:</b> @String.Format("{0:N0}", Model.ShipFee) Ä‘</div>

        <hr />

        <h5 class="fw-bold mt-3">ğŸ—º Báº£n Ä‘á»“ giao hÃ ng</h5>

        <div id="map" class="map-wrapper">
            <span id="map-status">â³ Äang táº£i báº£n Ä‘á»“...</span>
        </div>
    </div>

    <!-- ACTION BUTTONS -->
    <div class="row g-2 mt-3 mb-4">
        <div class="col-6 col-md-3">
            <a href="tel:@Model.ReceiverPhone" class="btn btn-outline-primary btn-driver">ğŸ“ Gá»i khÃ¡ch</a>
        </div>

        <div class="col-6 col-md-3">
            <a href="https://zalo.me/@Model.ReceiverPhone" class="btn btn-outline-info btn-driver">ğŸ’¬ Nháº¯n Zalo</a>
        </div>

        <div class="col-12 col-md-3">
            <a target="_blank"
               href="https://www.google.com/maps/dir/?api=1&destination=@(Model.Lat ?? 0),@(Model.Lng ?? 0)"
               class="btn btn-dark btn-driver">ğŸ“ Äiá»u hÆ°á»›ng</a>
        </div>

        <div class="col-6 col-md-3">
            <button class="btn btn-success btn-driver" data-bs-toggle="modal" data-bs-target="#podModal">âœ” ÄÃ£ giao (POD)</button>
        </div>

        <div class="col-6 col-md-3">
            <button class="btn btn-danger btn-driver" data-bs-toggle="modal" data-bs-target="#failModal">âœ– Giao tháº¥t báº¡i</button>
        </div>
    </div>

</div>

<!-- MODAL POD -->
<div class="modal fade" id="podModal">
    <div class="modal-dialog">
        <form asp-controller="Trip" asp-action="CompleteDelivery" method="post" enctype="multipart/form-data" class="modal-content">
            <input type="hidden" name="id" value="@Model.Id" />
            <div class="modal-header"><h5 class="modal-title">ğŸ“¸ Chá»¥p POD</h5></div>
            <div class="modal-body">
                <input type="file" name="podImage" class="form-control" accept="image/*" required />
            </div>
            <div class="modal-footer">
                <button class="btn btn-success">XÃ¡c nháº­n giao</button>
            </div>
        </form>
    </div>
</div>

<!-- MODAL FAILED -->
<div class="modal fade" id="failModal">
    <div class="modal-dialog">
        <form asp-controller="Trip" asp-action="FailedDelivery" method="post" class="modal-content">
            <input type="hidden" name="id" value="@Model.Id" />
            <div class="modal-header"><h5 class="modal-title">âŒ BÃ¡o tháº¥t báº¡i</h5></div>
            <div class="modal-body">
                <textarea name="reason" class="form-control" rows="4" placeholder="LÃ½ do giao tháº¥t báº¡i..." required></textarea>
            </div>
            <div class="modal-footer">
                <button class="btn btn-danger">XÃ¡c nháº­n</button>
            </div>
        </form>
    </div>
</div>

<!-- MAP SCRIPT -->
<script>
    function initMap() {

        const lat = @(Model.Lat ?? 0);
        const lng = @(Model.Lng ?? 0);

        if (lat === 0 || lng === 0) {
            document.getElementById("map-status").innerHTML = "âš  KhÃ´ng cÃ³ tá»a Ä‘á»™ Ä‘á»ƒ hiá»ƒn thá»‹.";
            return;
        }

        const pos = { lat: lat, lng: lng };

        const map = new google.maps.Map(document.getElementById("map"), {
            center: pos,
            zoom: 17
        });

        new google.maps.Marker({
            position: pos,
            map: map,
            title: "Äiá»ƒm giao"
        });

        document.getElementById("map-status").style.display = "none";
    }
</script>

<script src="https://maps.googleapis.com/maps/api/js?key=YOUR_KEY&callback=initMap" async defer></script>
